- job:
    name: 'cloud-ccp-full-periodic'
    node: cloud-trackupstream

    parameters:
      - string:
          name: ccp_repo
          default: https://github.com/SUSE-Cloud/socok8s.git
          description: The git repository to use

    triggers:
      - timed: '0 0 * * *'

    wrappers:
      - workspace-cleanup:
          dirmatch: true

    logrotate:
      numToKeep: 300
      daysToKeep: -1

    builders:
      - shell: |
          set -ex
          export PREFIX=${PREFIX:-'ccpci'}
          export OS_CLOUD=${OS_CLOUD:-'engcloud'}
          export KEYNAME=${KEYNAME:-'ccpcikey'}
          export INTERNAL_SUBNET="${PREFIX}-subnet"

          # Make sure the job has a cloud available, and environemnt
          # vars are properly defined
          cat ~/.config/openstack/clouds.yaml
          env

          # Get started
          mkdir ~/ccp/
          pushd ~/ccp
              # No need for branchname, as the full periodic job always tests
              # latest master branch
              git clone --recursive ${ccp_repo} socok8s
              pushd socok8s
                  ./run.sh
              popd
          rm -rf socok8s
          popd
      - shell: |
          # Destroy me the CCP env
          export PREFIX=${PREFIX:-'ccpci'}
          export OS_CLOUD=${OS_CLOUD:-'engcloud'}
          export KEYNAME=${KEYNAME:-'ccpcikey'}
          export INTERNAL_SUBNET="${PREFIX}-subnet"

          pushd ~/ccp/socok8s
              ./run.sh teardown
          popd
